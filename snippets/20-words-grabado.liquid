{%- assign product_form_id = 'product-form-' | append: section.id -%}
<script>
  document.addEventListener("DOMContentLoaded", function() {
    validador.VeintePalabras = false;
  })
  function sonTodosVerdaderos(objeto) {
    return Object.values(objeto).every(valor => valor === true);
  }
</script>
<div class="field-container" style="display: none;">
  <div class="field">
    <input
      form="{{ product_form_id }}"
      id="input-20palabras"
      class="field__input"
      type="text"
      name="properties[Tu frase personalizada]"
    >
    <label class="field__label" for="input-20palabras">Escribe tu frase personalizada: (máximo 20 palabras)</label>
  </div>
  <p id="error-message-20" class="error-message">Solo se permiten hasta 20 palabras</p>
  <p id="empty-message-20" class="empty-message">
    Por favor ingresa la frase personalizada <span class="question-mark">!</span>
  </p>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const inputField = document.querySelector("#input-20palabras");
    const errorMessage = document.getElementById("error-message-20");
    const emptyMessage = document.getElementById("empty-message-20");
    const fieldContainer = document.querySelector('.field-container');

    // Buscar opciones de "Grabado de frase" por el texto del label
    let conFraseOption = null;
    let sinFraseOption = null;

    const allRadios = document.querySelectorAll('input[type="radio"]');

    allRadios.forEach(radio => {
      const label = document.querySelector(`label[for="${radio.id}"]`);
      if (label) {
        const labelText = label.textContent.trim().toLowerCase();
        if (labelText.includes('con frase')) {
          conFraseOption = radio;
        } else if (labelText.includes('sin frase')) {
          sinFraseOption = radio;
        }
      }
    });

    // Si no encontró por label, intentar con los IDs conocidos
    if (!conFraseOption || !sinFraseOption) {
      conFraseOption = conFraseOption || document.getElementById("template--17075361873989__main-1-1");
      sinFraseOption = sinFraseOption || document.getElementById("template--17075361873989__main-1-0");
    }

    // Verificar que se encontraron las opciones
    if (!conFraseOption || !sinFraseOption) {
      console.error("No se pudieron encontrar las opciones de 'Grabado de frase'. Verificar IDs o nombres de opciones.");
      validador.VeintePalabras = true;
      return;
    }

    // Función para validar el campo de texto
    function validarTexto() {
      const words = inputField.value.split(/\s+/).filter(word => word.length > 0);
      const wordCount = words.length;

      if (wordCount === 0 || wordCount > 20) {
        validador.VeintePalabras = false;
        errorMessage.style.display = wordCount > 20 ? "block" : "none";
      } else {
        validador.VeintePalabras = true;
        errorMessage.style.display = "none";
        if (sonTodosVerdaderos(validador)) {
          addToCartButton.disabled = false;
        }
      }
      emptyMessage.style.display = wordCount === 0 ? "flex" : "none";
    }

    // Función para mostrar/ocultar el campo de texto según la opción seleccionada
    function toggleCustomTextField() {
      if (conFraseOption.checked) {
        fieldContainer.style.display = 'flex';
        validador.VeintePalabras = false;
        validarTexto();
      } else if (sinFraseOption.checked) {
        fieldContainer.style.display = 'none';
        validador.VeintePalabras = true;
        inputField.value = '';
        errorMessage.style.display = 'none';
        emptyMessage.style.display = 'none';
        if (sonTodosVerdaderos(validador)) {
          addToCartButton.disabled = false;
        }
      }
    }

    // Inicializar según la opción seleccionada por defecto
    toggleCustomTextField();

    // Escuchar cambios en las opciones
    conFraseOption.addEventListener("change", toggleCustomTextField);
    sinFraseOption.addEventListener("change", toggleCustomTextField);

    // Validar texto cada vez que el usuario escribe
    inputField.addEventListener("input", validarTexto);
  });
</script>
<style>
  .field-container {
    display: flex;
    flex-direction: column;
    gap: 5px;
    max-width: 300px;
  }

  .field__input {
    width: 100%;
    padding: 8px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 4px;
    transition: border-color 0.3s;
  }

  .field__input:focus {
    border-color: #ff6600;
    outline: none;
  }

  .field {
    position: relative;
    display: flex;
    flex-direction: column;
  }

  .field__label {
    font-size: 14px;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
  }

  .error-message, .empty-message {
    color: #962020;
    font-size: 12px;
  }

  .error-message {
    display: none;
  }

  .empty-message {
    display: flex;
    align-items: center;
  }

  .question-mark {
    font-weight: bold;
    color: red;
    margin-right: 5px;
  }
</style>
