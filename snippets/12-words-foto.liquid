{%- assign product_form_id = 'product-form-' | append: section.id -%}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    validador.DocePalabras = false;
  });
  
  function sonTodosVerdaderos(objeto) {
    return Object.values(objeto).every((valor) => valor === true);
  }
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const inputField = document.querySelector('#nombre-input-2');
    const errorMessage = document.getElementById('error-message');
    const emptyMessage = document.getElementById('empty-message');
    const conMarcacionOption = document.getElementById('template--16597763031109__main-1-1'); // ID for "Con marcación"
    const sinMarcacionOption = document.getElementById('template--16597763031109__main-1-0'); // ID for "Sin marcación"

    // Function to show/hide the custom text field
    function toggleCustomTextField() {
      const isConMarcacionSelected = conMarcacionOption.checked;
      document.querySelector('.field-container').style.display = isConMarcacionSelected ? 'flex' : 'none';
      
      if (conMarcacionOption.checked) {
        validador.DocePalabras = false;
        validarTexto();
      } else if (sinMarcacionOption.checked) {
        validador.DocePalabras = true; // Updates validator to true if "Sin marcación" is selected
        if (sonTodosVerdaderos(validador)) {
          addToCartButton.disabled = false;
        }
      }
    }

    // Initialize field according to default option (Sin Marcación)
    toggleCustomTextField();

    // Listen for changes in marking options
    conMarcacionOption.addEventListener('change', toggleCustomTextField);
    sinMarcacionOption.addEventListener('change', toggleCustomTextField);

    // Show "Please enter custom phrase" message from the start
    emptyMessage.style.display = 'flex';

    // Function to validate text field
    function validarTexto() {
      const words = inputField.value.split(/\s+/).filter((word) => word.length > 0);
      const wordCount = words.length;

      // Check if field is empty or doesn't meet conditions
      if (wordCount === 0 || wordCount > 12) {
        validador.DocePalabras = false; // Always when there's error or empty
        errorMessage.style.display = wordCount > 0 ? 'block' : 'none'; // Show or hide error
      } else {
        validador.DocePalabras = true; // Only if conditions are met
        errorMessage.style.display = 'none'; // Hide error message
        if (sonTodosVerdaderos(validador)) {
          addToCartButton.disabled = false;
        }
      }

      // Show "Please enter custom phrase" message if empty
      emptyMessage.style.display = wordCount === 0 ? 'flex' : 'none';
    }

    // Listen to input event and validate text each time it changes
    inputField.addEventListener('input', function () {
      validarTexto();
    });
  });
</script>

<div class="field-container">
  <!-- Custom text input field with style and label -->
  <div class="field">
    <input
      class="field__input"
      type="text"
      form="{{ product_form_id }}"
      name="properties[Tu frase personalizada]"
      id="nombre-input-2"
      required
    >
    <label class="field__label" for="nombre-input-2">Escribe tu frase personalizada: (máximo 11 palabras)</label>
  </div>
  <p id="error-message" class="error-message">Solo se permiten hasta 11 palabras</p>
  <p id="empty-message" class="empty-message">
    Por favor ingresa la frase personalizada <span class="question-mark">!</span>
  </p>
</div>

<style>
  .field-container {
    display: flex;
    flex-direction: column;
    gap: 5px;
    max-width: 300px;
  }

  .field__input {
    width: 100%;
    padding: 8px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 4px;
    transition: border-color 0.3s;
  }

  .field__input:focus {
    border-color: #ff6600;
    outline: none;
  }

  .field {
    position: relative;
    display: flex;
    flex-direction: column;
  }

  .field__label {
    font-size: 14px;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
  }

  .error-message, .empty-message {
    color: #961212;
    font-size: 12px;
  }

  .error-message {
    display: none;
  }

  .empty-message {
    display: flex;
    align-items: center;
  }

  .question-mark {
    font-weight: bold;
    color: #961212;
    margin-right: 5px;
  }
</style>